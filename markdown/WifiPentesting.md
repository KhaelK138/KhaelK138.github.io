---
layout: blank
pagetitle: Pentesting WiFi
---

## Authentication Types and Protocol Information

**WEP**
- Wired Equivalent Privacy
- Original wifi security protocol, basic encryption but pretty easy to breach

**WPA**
- wifi Protected Access
- Better encryption via Temporal Kep Integrity Protocol, but still not as great as new standards

**WPA2**
- wifi Protected Access 2
- Uses AES for better security, standard for many years

**WPA3**
- wifi Protected Access 3
- Individualized data encryption and better password-based authentication; currently the best option

**IEEE 802.11 Frames and Types**
- Uses a MAC frame with 9 fields
  - Frame Control: Type, subtype, protocol version, order, and so on
  - Duration: Amount of time in which wireless medium is occupied
  - Address 1/2/3/4: MAC addresses involved in the communication (BSSID of access point (AP); client MAC)
  - Sequence Control (SC): Info to prevent duplicate frames
  - Data: The data transmitted to the receiver
  - Cycle Redundancy Check (CRC): 32-bit checksum 
- Frame Types (what does the frame do):
  - Management (00): Used for management and control, allowing AP/client to control connection
  - Control (01): Used for managing transmission and reception of data frames (sort of a quality control)
  - Data (10): Contain data for transmission
- Management Frame Sub-Types:
  - Beacon Frames (1000): Frame used by AP to communicate its presence to client (supported ciphers, auth types, SSID, supported data rates)
  - Probe Request/Response (0100/0101): Client sends to discover nearby APs, which APs then respond to
  - Authentication Request/Response (1011): Sent by client to initiate connection process, used mainly to identify client to AP
  - Association/Reassociation Request/Response (0000/0001/0010/0011): Sent after performing authentication, informs AP of client's capabilities; AP responds back with success/denial based on client capabilities
  - Disassociation/Deauthentication (1010, 1100): Sent by client to access point to terminate connection; contain a reason code listing reason for disconnection
- To identify these frames in Wireshark, use `(wlan.fc.type == {frame_type_decimal}) && (wlan.fc.type_subtype == {frame_subtype_decimal})`
  - For example, a beacon frame would look like `(wlan.fc.type == 0) && (wlan.fc.type_subtype == 8)`, as the management frame ID is `00` and the decimal representation of a beacon frame ID is `8`

**Connection Cycle in Full**
1. AP sends beacon frames out
2. Client notices AP, sends probe request
3. AP responds to probe request
4. Client sends authentication request to AP
5. AP responds with authentication response
6. Client sends association response 
7. AP sends association response
8. Client performs EAPOL (handshake) if using WPA2+

## Authentication Methods

**Open System Authentication**
- No shared secrets/credentials for initial access
- Usually used in open networks (allowing any device to connect without verification)

**Shared Key Authentication**
- Each side computes a challenge/response based on a shared key (a network password, e.g. `12345678`), with WPA2 being:
  - The AP sends a nonce (ANonce) value to the client, which the client uses (alongside the shared key and both MAC addresses) to generate the Pairwise Master Key (PMK)
  - Client responds with a new nonce (SNonce) and the Message Integrity Code (derived from PMK with HMAC) 
  - AP decrypts challenge and sends back success/failure
- WPA3 adds on additional security checks protecting against brute force attacks

## WiFi Interfaces

- For external wifi adapters, drivers need to be installed to use wifi networks (as opposed to something like a laptop with the drivers preinstalled)

**Interface Strength**
- Pentesting wifi networks often comes down to physical positioning, so we can ramp up the strength of or card using `iwconfig`
  - This will tell us what interfaces we have available and at what strength (`Tx-Power` they're operating at)
    - This often correlates with the country we're in, as some countries make it illegal to increase this
  - Need to first set the interface down with `sudo iwconfig {interface_like_wlan0} down`
  - Then, increase the strength with `sudo iwconfig {interface} txpower 30`
    - Default is 20 dBm, but it can be increased to 30 as shown
  - Then, just set the interface back up with `sudo iwconfig {interface} up`
- List information about our interfaces with `iw list`, like what our interface supports
  - List available channels for our interfaces with `iwlist {interface} channel`
  - We can then configure our interface to use a specified available channel by setting the interface down, doing `sudo iwconfig {interface} channel {channel_number}`, and then bringing the channel back up
    - Similar story for setting frequency with `freq "{desired_frequency_like_5.52G}"`
- Scan for wifi networks with `iwlist {interface} scan`
  - To reduce to manageable information, use `| grep 'Cell\|Quality\|ESSID\|IEEE'`

**Interface Modes**
- Interfaces can have different modes depending on what we need them to do
- After setting the interface as down, we can change the mode with `sudo iwconfig {interface} mode {mode}`
- Managed mode
  - Have our interface act as a client/station (authentication to APs, have basic service set, and actively search for APs to connect to)
  - Usually the default, set with `managed` mode as shown above
  - Can then connect to a network with `sudo iwconfig {interface} essid {AP_ESSID}`
- Ad-hoc mode
  - Peer-to-peer mode and allows direct communication between wireless interfaces
  - Set to `ad-hoc` same as above
- Master mode
  - Essentially an AP/router mode
    - Useful for rogue AP or evil-twin attacks (trying to get people to connect to us)
  - Can't simply just be set as a mode, requires a daemon and configuration 
    - We can use `hostapd` for this, making a config file like below and using `sudo hostapd {config_file}` to bring it up

```
interface=wlan0
driver=nl80211
ssid=Hello-World
channel=2
hw_mode=g
```

- Mesh mode
  - Sets interface to join a self-configuring and routing network
    - Common in business applications with large coverage across a physical space
  - `sudo iw dev {interface} set type mesh`
- Monitor mode
  - Promiscuous mode where all wireless traffic will be captured regardless of intended recipient
  - Bring interface down, run `sudo iw {interface} set monitor control`, and then bring it back up

## Aircrack-ng

- Pretty comprehensive suite of tools meant for testing wifi
- Has tools focusing on monitoring, attacking, testing, and cracking

**Airmon-ng**
- Can be used to enable monitor mode on wireless interfaces
- Run `sudo airmon-ng` without params to show interface info
- Turn interface into monitor mode using `airmon-ng start {interface}`
  - Sometimes other processes can interfere, which we can check for with `airmon-ng check`
  - Make sure it's running with `iwconfig`, which should show something like `{interface}mon`
- We can also monitor only a single channel with `start {interface} {channel_number}`
- Stop monitor mode with `airmon-ng stop {interface}mon`

**Airodump-ng**
- Used for capturing raw 802.11 frames and generating information files for scripting or investigation
- We first need monitor mode to be on, so `airmon-ng start {interface}`
- Then, start with `airodump-ng {interface}mon`
  - Can specify channels with `-c {channel_number}`
- Airodump scans 2.4GHz by default, so scan 5 GHz with `--band a`
  - `a` uses 5 GHz, `b` and `g` use 2.4 GHz
  - Can also just specify all three with `--band abg`
- Write to files with `--write {prefix}`, which will generate csv, cap, and netxml files

**Airgraph-ng**
- Used to graphically represent networks using information captured by `airodump`
- Color-coded by encryption type
  - Green for WPA, yellow for WEP, red for open networks, and black for unknown
- Run with `sudo airgraph-ng -i  {main_csv_file} -g CAPR -o {output_png_name}`

**Aireplay-ng**
- 